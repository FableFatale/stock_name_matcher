# 股票数据管理系统使用说明

## 🎯 功能概述

股票数据管理系统现已全面升级，提供了完整的API密钥配置、股票列表管理和数据源监控功能。

## 🔑 API密钥配置

### 支持的数据源
- **AKShare**: 免费的中文股票数据接口（通常无需API密钥）
- **Tushare**: 专业的金融数据平台（需要注册获取API密钥）
- **Alpha Vantage**: 国际股票和金融数据（需要API密钥）
- **Quandl**: 金融和经济数据平台（需要API密钥）
- **本地数据源**: 使用本地股票列表文件（推荐，无需网络）

### 配置步骤
1. 打开Web界面 (http://localhost:5000)
2. 展开"股票数据管理"面板
3. 在"API密钥配置"区域输入相应的API密钥
4. 点击"保存API密钥"按钮
5. 使用"测试所有连接"验证配置

### 安全性
- 所有API密钥都经过加密存储
- 配置文件中不会显示明文密钥
- 支持密钥长度和配置状态显示

## 📁 股票列表文件管理

### 文件格式要求
```csv
代码,名称
000001,平安银行
000002,万科A
000004,国华网安
```

**格式规范：**
- CSV格式，UTF-8编码
- 必须包含：`代码` 和 `名称` 列（或 `code` 和 `name` 列）
- 股票代码支持6位数字格式
- 文件大小限制：16MB

### 上传方式
1. **Web界面上传**：
   - 在"上传股票列表"区域选择CSV文件
   - 点击"上传股票数据"按钮
   - 系统会自动验证文件格式

2. **目录监控上传**：
   - 将CSV文件放入 `stock_name_list` 目录
   - 点击"检查更新"按钮
   - 系统会自动处理新文件

### 文件处理流程
1. **验证**：检查文件格式和内容
2. **备份**：自动备份现有数据
3. **安装**：将新数据安装到系统
4. **更新**：更新股票匹配器数据

## 🔄 数据源状态监控

### 实时状态显示
- 各数据源的连接状态
- 当前股票数据统计
- API密钥配置状态
- 数据更新时间

### 连接测试
- **单个测试**：点击各API密钥旁的"测试"按钮
- **批量测试**：点击"测试所有连接"按钮
- **状态指示**：
  - 🟢 成功：数据源正常可用
  - 🔴 失败：连接失败或配置错误
  - 🟡 警告：部分功能受限

## ⚙️ 系统配置

### 配置文件位置
- 主配置文件：`config.json`
- 加密密钥：`.encryption_key`（自动生成）

### 配置项说明
```json
{
  "api_keys": {
    "akshare": "加密存储的API密钥",
    "tushare": "加密存储的API密钥"
  },
  "data_sources": {
    "primary": "local",
    "fallback": ["akshare", "sina", "tencent"],
    "timeout": 30,
    "retry_count": 3
  },
  "system_settings": {
    "max_file_size_mb": 16,
    "auto_backup": true,
    "performance_optimization": true
  }
}
```

### 高级配置
- **主要数据源**：优先使用的数据源
- **备用数据源**：主数据源失败时的备选方案
- **超时设置**：API请求超时时间
- **重试次数**：失败后的重试次数
- **缓存时长**：数据缓存有效期

## 🛠️ 故障排除

### 常见问题

**1. API密钥配置失败**
- 检查密钥格式是否正确
- 确认API服务商账户状态
- 验证网络连接

**2. 文件上传失败**
- 检查文件格式（必须是CSV）
- 确认文件编码（推荐UTF-8）
- 验证列名（代码、名称）
- 检查文件大小（<16MB）

**3. 数据源连接失败**
- 检查网络连接
- 验证API密钥配置
- 查看系统日志

**4. 股票匹配不准确**
- 更新股票列表文件
- 检查股票代码格式
- 使用多数据源验证

### 日志查看
- 应用日志：`app.log`
- 匹配日志：`logs/` 目录
- 配置日志：控制台输出

## 📊 性能优化

### 推荐设置
1. **使用本地数据源**：响应最快，无网络依赖
2. **启用性能优化**：并行处理，提升速度
3. **合理设置缓存**：减少重复请求
4. **定期更新数据**：保持数据新鲜度

### 批量处理建议
- 大文件分批处理
- 启用进度显示
- 使用性能优化模式
- 避免频繁切换数据源

## 🔧 开发者接口

### API端点
```
GET  /api/config                    # 获取配置摘要
GET  /api/config/api_keys          # 获取API密钥状态
POST /api/config/api_keys          # 设置API密钥
GET  /api/config/test_connection/<source>  # 测试连接
GET  /api/stock_data_status        # 获取股票数据状态
```

### 编程接口
```python
from config_manager import config_manager

# 设置API密钥
config_manager.set_api_key('tushare', 'your_api_key')

# 获取API密钥
api_key = config_manager.get_api_key('tushare')

# 测试连接
result = config_manager.test_api_connection('akshare')

# 获取配置摘要
summary = config_manager.get_config_summary()
```

## 📞 技术支持

如果遇到问题，请：
1. 查看本文档的故障排除部分
2. 检查系统日志文件
3. 运行测试脚本：`python test_config_manager.py`
4. 提供详细的错误信息和操作步骤

---

**版本**: 1.0.0  
**更新时间**: 2025-07-11  
**兼容性**: Python 3.7+, Flask 2.0+
