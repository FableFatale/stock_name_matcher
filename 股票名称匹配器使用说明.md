# 股票名称匹配器使用说明

## 功能介绍

股票名称匹配器是一个Python脚本，可以从Excel或CSV文件中读取股票名称，使用免费的AKShare API来获取最可能的A股股票信息。

## 主要特性

- 支持Excel (.xlsx, .xls) 和CSV文件格式
- 自动检测股票名称和价格列
- 多种匹配策略：精确匹配、模糊匹配、包含匹配
- 价格验证功能，提高匹配准确性
- 详细的匹配结果和备选方案
- 完整的日志记录

## 安装依赖

首先安装必要的Python包：

```bash
pip install akshare fuzzywuzzy python-Levenshtein pandas openpyxl
```

或者使用项目的requirements.txt：

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本用法

```bash
python stock_name_matcher.py input_file.xlsx
```

### 指定输出文件

```bash
python stock_name_matcher.py input_file.xlsx -o output_results.csv
```

### 指定列名

```bash
python stock_name_matcher.py input_file.xlsx -n "股票名称" -p "价格"
```

### 完整参数

```bash
python stock_name_matcher.py input_file.xlsx \
    --output results.csv \
    --name-column "股票名称" \
    --price-column "参考价格"
```

## 输入文件格式

### Excel文件示例

| 股票名称 | 参考价格 |
|---------|---------|
| 平安银行 | 10.45   |
| 招商银行 | 35.20   |
| 中国平安 | 45.80   |

### CSV文件示例

```csv
股票名称,参考价格
平安银行,10.45
招商银行,35.20
中国平安,45.80
```

## 输出结果

脚本会生成一个CSV文件，包含以下列：

- **原始名称**: 输入的股票名称
- **参考价格**: 输入的参考价格
- **匹配股票代码**: 匹配到的股票代码
- **匹配股票名称**: 匹配到的股票名称
- **当前价格**: 当前市场价格
- **匹配类型**: 匹配方式（精确匹配/模糊匹配/包含匹配）
- **匹配度**: 匹配相似度（0-100）
- **价格差异**: 与参考价格的差异
- **备选1_代码/名称**: 第二个最佳匹配
- **备选2_代码/名称**: 第三个最佳匹配

## 匹配策略

### 1. 精确匹配
完全匹配股票名称，匹配度为100%

### 2. 模糊匹配
使用模糊字符串匹配算法，处理拼写差异和简称

### 3. 包含匹配
检查股票名称是否包含输入的关键词

### 4. 价格验证
如果提供了参考价格，会优先选择价格接近的股票

## 自动列检测

脚本会自动检测以下列名：

**股票名称列关键词**:
- 名称、股票名称、股票、证券名称、证券
- name、stock、symbol_name

**价格列关键词**:
- 价格、股价、现价、最新价、收盘价
- price、close、元

## 示例运行

使用提供的示例文件：

```bash
python stock_name_matcher.py example_stocks.csv
```

## 日志文件

程序运行时会在`logs`目录下生成详细的日志文件，包含：
- 处理进度
- 匹配结果
- 错误信息
- 统计数据

## 注意事项

1. **网络连接**: 需要稳定的网络连接来访问AKShare API
2. **API限制**: 为避免API限制，程序在每次请求间添加了延迟
3. **数据准确性**: 股票价格为实时数据，可能与参考价格有差异
4. **匹配准确性**: 建议提供准确的股票名称和参考价格以提高匹配准确性

## 错误处理

常见错误及解决方案：

1. **文件不存在**: 检查输入文件路径是否正确
2. **列名不匹配**: 使用`-n`和`-p`参数指定正确的列名
3. **网络错误**: 检查网络连接，稍后重试
4. **依赖包缺失**: 运行`pip install -r requirements.txt`

## 技术支持

如有问题，请查看日志文件获取详细错误信息。
